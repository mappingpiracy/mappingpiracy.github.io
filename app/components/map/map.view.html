<leaflet class="incident-map" defaults="map.defaults" center="map.center" geojson="map.geojson"></leaflet>

<div class="pane--ui-controls">
  <form class="form-inline" role="form">
    <div class="form-group">
      <label>Data Source</label>
      <select ng-model="dataSource" ng-init="dataSource = dataSources[0]" ng-options="ds.name for ds in dataSources" class="form-control">
      </select>
      <button type="button" class="btn btn-default" ng-click="populateDefaultData()">Update Data Source</button>
    </div>|
    <button type="button" class="btn btn-primary" ng-click="showFilters = !showFilters">Data Filters</button>
    <button type="button" class="btn btn-primary" ng-click="showAnalysis = !showAnalysis">Data Analysis</button>
    <button type="button" class="btn btn-primary" ng-click="exportData()">Export Data</button>
    <span ng-show="map.geojson.data.features !== null">
      <label>| Displaying {{map.geojson.data.features.length}} incidents</label>
    </span>
  </form>
</div>

<div class="pane--data-filter" ng-show="showFilters">
  <header class="pane__header">
    <h3>Data Filters</h3>
    <small>Modify the filters below, then click 'Apply Filters' to see the resulting incidents.</small>
  </header>
  <div class="btn-group" role="group" aria-label="...">
    <button type="button" class="btn btn-primary" ng-click="populateIncidents()">Apply Filters</button>
    <button type="button" class="btn btn-default" ng-click="resetDataFilters()">Reset Filters</button>
  </div>
  <div class="pane--data-filter__content">

    <!-- Date Range Filter Begin -->
    <div class="panel panel-default">
      <div class="panel-heading">
        <h4>Date Range</h4>
      </div>
      <div class="panel-body">
        <label>Year</label>
        <select ng-model="dataFilters.selectedYear" ng-init="dataFilters.selectedYear = dataFilters.years[0]" ng-options="year for year in dataFilters.years" class="form-control">
        </select>
        <hr>
        <!-- Date inputs have to be wrapped in their own divs,
        otherwise the date picker will fall to the bottom
        of the next block-level element. -->
        <div>
          <label>Begin Date</label>
          <input type="date" class="form-control" ng-model="dataFilters.beginDate"></input>
        </div>
        <hr>
        <div>
          <label>End Date</label>
          <input type="date" class="form-control" ng-model="dataFilters.endDate"></input>
        </div>
      </div>
    </div>
    <!-- Date Range Filter End -->
    <!-- Location Information Filter Begin -->
    <div class="panel panel-default">
      <div class="panel-heading">
        <h4>Location Information</h4>
      </div>
      <div class="panel-body">
        <label>Closest Coastal State</label>
        <typeahead-multiselect all-items="dataFilters.countries" selected-items="dataFilters.selectedClosestCoastalStates"></typeahead-multiselect>
        <hr>
        <label>Territorial Water Status</label>
        <typeahead-multiselect all-items="dataFilters.territorialWaterStatuses" selected-items="dataFilters.selectedTerritorialWaterStatuses"></typeahead-multiselect>
        <hr>
        <label>Geolocation Source</label>
        <br>
        <small>Use CTRL+click or drag to select multiples</small>
        <select multiple class="form-control"
          ng-options="geolocationSource as geolocationSource for geolocationSource in dataFilters.geolocationSources" ng-model="dataFilters.selectedGeolocationSources">
        </select>
      </div>
    </div>
    <!-- Location Information Filter End -->
    <!-- Vessel Information Filter Begin -->
    <div class="panel panel-default">
      <div class="panel-heading">
        <h4>Vessel Information</h4>
      </div>
      <div class="panel-body">
        <label>Vessel Country</label>
        <typeahead-multiselect all-items="dataFilters.countries" selected-items="dataFilters.selectedVesselCountries"></typeahead-multiselect>
        <hr>
        <label>Vessel Status</label>
        <br>
        <small>Use CTRL+click or drag to select multiples</small>
        <select multiple class="form-control"
          ng-options="vesselStatus as vesselStatus for vesselStatus in dataFilters.vesselStatuses" ng-model="dataFilters.selectedVesselStatuses">
        </select>
      </div>
    </div>
    <!-- Vessel Information Filter End -->
    <!-- Incident Information Filter Begin -->
    <div class="panel panel-default">
      <div class="panel-heading">
        Incident Information
      </div>
      <div class="panel-body">
        <label>Incident Type</label>
        <br>
        <small>Use CTRL+click or drag to select multiples</small>
        <select multiple class="form-control"
          ng-options="incidentType as incidentType for incidentType in dataFilters.incidentTypes" ng-model="dataFilters.selectedIncidentTypes">
        </select>
        <hr>
        <label>Incident Action</label>
        <br>
        <small>Use CTRL+click or drag to select multiples</small>
        <select multiple class="form-control"
          ng-options="incidentAction as incidentAction for incidentAction in dataFilters.incidentActions" ng-model="dataFilters.selectedIncidentActions">
        </select>
      </div>
    </div>
    <!-- Incident Information Filter End -->
  </div>
</div>

<div class="pane--data-analysis" ng-if="showAnalysis">
  <header class="pane__header">
    <h3>Data Analysis</h3>
    <small>Incidents per year, grouped by the 'Closest Coastal State' filter.</small>
    <button ng-click="changeDirective()">Change some stuff</button>
  </header>
  <div class="pane--data-analysis__content">
    <!-- <nvd3 options="incidentsPerYearChart" data="incidentsPerYearChart.chart.data"></nvd3> -->
    <incidents-per-year data="analysis.incidentsPerYear"></incidents-per-year>
  </div>
</div>
